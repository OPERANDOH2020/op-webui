
<!--Created by IT Innovation Centre, Christopher Coles, 06/09/2017-->
@{ int rowIdNumber = 0;} 
@foreach (var osp in ViewBag.ospList)
{
@osp.PolicyText

<table class="table table-bordered table-condensed table-hover table-striped">
    <thead>
        <tr>

            <th>Resource</th>
            <th>Category</th>
        </tr>
    </thead>
    <tbody>
        
                @{ List<string> resources = new List<string>();}
                @foreach (var accessPolicy in osp.Policies)
                {
                    if (!(resources.Contains(accessPolicy.Resource)))
                    {
                        resources.Add(accessPolicy.Resource);
                    }
                }
                @foreach(var resource in resources) { 
                {rowIdNumber++;}
                    <tr>
                        <td id="@(rowIdNumber)resource">@resource</td>

                        <td>
                           
                                   
                                    <select id="@(rowIdNumber)selector">
                            @foreach (var reasonPolicy in ViewBag.reasonPolicies)
                            {
                                if (reasonPolicy.OspPolicyId.Equals(osp.OspPolicyId))
                                {
                                                foreach (var policydata in reasonPolicy.Policies)
                                                {
                                                    <option>@policydata.Datatype</option>

                                                }
                                        }
                                    }
                                        <option>test1</option>
                                        <option>test2</option>
                                </select>

                                    
                                
                        </td>
                    </tr>
                }
    </tbody>
</table>
        }

<button onclick="submit(@rowIdNumber)">submit</button>
<button onclick="removeAll()">remove all records</button>
<div id="responseText"></div>
<script>

    function submit(numberOfRows) {
        var resourcearr = new Array();
        var categoryarr = new Array();
        for (i = 1; i <= numberOfRows; i++) {
            var resource = document.getElementById(i + "resource").innerText;
            resourcearr.push(resource);
            var categorySelector = document.getElementById(i + "selector");
            var category = categorySelector.options[categorySelector.selectedIndex].text;
            categoryarr.push(category);
        }
         $.ajax({
                type: "put",
                data: { resourcearr: resourcearr, categoryarr: categoryarr },
                url: '@Url.Action("updateAccessPolicyCategory", "OspAdmin")',
                success: successFunc,
                error: errorFunc
        });
         function successFunc(data, status) {
             alert('Categories updated, please reload page to see updates');
         }

         function errorFunc() {
             alert('error');
         }
    }

    function removeAll() {
        $.ajax({
            type: "delete",
            url: '@Url.Action("deleteAccessPolicyCategory", "OspAdmin")',
            success: successFunc,
            error: errorFunc
        });
        function successFunc(data, status) {
            alert('Categories deleted, please reload page to see updates');
        }

        function errorFunc() {
            alert('error');
        }
    }
</script>